<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Notes App</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <link rel="icon" href="favicon.png" type="image/png" />
  <body
    class="bg-gradient-to-br from-indigo-50 via-white to-purple-50 min-h-screen"
  >
    <div class="max-w-7xl mx-auto p-6">
      <div class="mb-8">
        <h1 class="text-4xl font-bold text-gray-900 mb-2">AI Notes</h1>
        <p class="text-gray-600">Powered by AI</p>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Sidebar -->
        <div class="lg:col-span-1">
          <div class="bg-white rounded-xl shadow-lg p-6">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-xl font-semibold text-gray-800">My Notes</h2>
              <button
                onclick="createNewNote()"
                class="p-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700"
              >
                ‚ûï
              </button>
            </div>

            <button
              onclick="toggleAiPanel()"
              class="w-full mb-4 p-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-lg hover:from-purple-700 hover:to-indigo-700"
            >
              ‚ú® Generate with AI
            </button>

            <div class="flex gap-2 mb-4">
              <button
                onclick="exportNotes()"
                class="flex-1 p-2 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700"
              >
                üì• Export
              </button>
              <button
                onclick="importNotes()"
                class="flex-1 p-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700"
              >
                üì§ Import
              </button>
            </div>
            <input
              type="file"
              id="importFile"
              accept=".json"
              style="display: none"
              onchange="handleImport(event)"
            />

            <div id="notesList" class="space-y-2 max-h-96 overflow-y-auto">
              <p class="text-gray-400 text-center py-8">No notes yet</p>
            </div>
          </div>

          <!-- API Key Setup - Collapsible -->
          <div class="bg-white rounded-xl shadow-lg p-6 mt-6">
            <button
              onclick="toggleSettings()"
              class="w-full flex items-center justify-between font-semibold mb-2 hover:text-indigo-600"
            >
              <span>‚öôÔ∏è AI Settings</span>
              <span id="settingsToggle">‚ñº</span>
            </button>
            <div id="settingsPanel" class="hidden">
              <label class="text-sm text-gray-600">API Provider:</label>
              <select
                id="aiProvider"
                class="w-full p-2 border rounded mb-2"
                onchange="updateApiKeyPlaceholder()"
              >
                <option value="groq">Groq (Free & Fast)</option>
                <option value="openai">OpenAI</option>
                <option value="anthropic">Anthropic</option>
              </select>
              <label class="text-sm text-gray-600">API Key:</label>
              <input
                type="password"
                id="apiKey"
                placeholder="Enter your API key"
                class="w-full p-2 border rounded mb-2"
              />
              <button
                onclick="saveApiKey()"
                class="w-full p-2 bg-green-600 text-white rounded hover:bg-green-700"
              >
                Save API Key
              </button>
              <p class="text-xs text-gray-500 mt-2">
                Get free API key at:
                <a
                  id="apiLink"
                  href="https://console.groq.com"
                  target="_blank"
                  class="text-blue-600 underline"
                  >console.groq.com</a
                >
              </p>
            </div>
          </div>
        </div>

        <!-- Main Content -->
        <div class="lg:col-span-2">
          <!-- AI Panel -->
          <div
            id="aiPanel"
            class="bg-gradient-to-br from-purple-50 to-indigo-50 rounded-xl shadow-lg p-6 mb-6 hidden"
          >
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-xl font-semibold text-gray-800">
                ‚ú® AI Note Generator
              </h2>
              <button
                onclick="toggleAiPanel()"
                class="p-1 hover:bg-white rounded"
              >
                ‚úï
              </button>
            </div>
            <input
              type="text"
              id="aiPrompt"
              placeholder="What would you like notes about? (e.g., 'React hooks tutorial')"
              class="w-full p-3 border-2 border-indigo-200 rounded-lg mb-3"
              onkeypress="if(event.key==='Enter') generateWithAI()"
            />
            <button
              onclick="generateWithAI()"
              class="w-full p-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-lg hover:from-purple-700 hover:to-indigo-700"
            >
              Generate Note
            </button>
          </div>

          <!-- Editor -->
          <div class="bg-white rounded-xl shadow-lg p-6">
            <div id="emptyState" class="text-center py-20">
              <div class="text-6xl mb-4">üìù</div>
              <h3 class="text-xl font-semibold text-gray-600 mb-2">
                No note selected
              </h3>
              <p class="text-gray-400 mb-6">
                Create a new note or select an existing one
              </p>
              <button
                onclick="createNewNote()"
                class="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700"
              >
                Create New Note
              </button>
            </div>

            <div id="editor" class="hidden">
              <input
                type="text"
                id="noteTitle"
                placeholder="Note Title"
                class="w-full text-2xl font-bold mb-4 p-2 border-b-2 border-gray-200 focus:outline-none focus:border-indigo-500"
              />
              <textarea
                id="noteContent"
                placeholder="Start writing your note..."
                class="w-full h-96 p-4 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-500 resize-none"
              ></textarea>
              <div class="flex gap-3 mt-4">
                <button
                  onclick="saveNote()"
                  class="flex-1 p-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700"
                >
                  ‚úì Save Note
                </button>
                <button
                  onclick="summarizeWithAI()"
                  class="flex-1 p-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg hover:from-purple-700 hover:to-pink-700"
                >
                  ‚ú® AI Summarize
                </button>
                <button
                  onclick="cancelEdit()"
                  class="p-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300"
                >
                  Cancel
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      let notes = [];
      let currentNote = null;
      let apiKey = localStorage.getItem("aiApiKey") || "";
      let apiProvider = localStorage.getItem("aiProvider") || "groq";

      // Load notes from localStorage
      function loadNotes() {
        const saved = localStorage.getItem("notes");
        notes = saved ? JSON.parse(saved) : [];
        renderNotesList();
      }

      function saveNotes() {
        localStorage.setItem("notes", JSON.stringify(notes));
      }

      function renderNotesList() {
        const list = document.getElementById("notesList");
        if (notes.length === 0) {
          list.innerHTML =
            '<p class="text-gray-400 text-center py-8">No notes yet</p>';
          return;
        }

        list.innerHTML = notes
          .map((note) => {
            const escapedId = note.id.replace(/'/g, "\\'");
            const escapedTitle = (note.title || "Untitled")
              .replace(/</g, "&lt;")
              .replace(/>/g, "&gt;");
            const escapedContent = (note.content || "")
              .replace(/</g, "&lt;")
              .replace(/>/g, "&gt;");

            return `
                <div onclick="editNote('${escapedId}')" 
                     class="p-3 rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition">
                    <div class="flex items-start justify-between">
                        <div class="flex-1 min-w-0">
                            <h3 class="font-medium text-gray-900 truncate">${escapedTitle}</h3>
                            <p class="text-sm text-gray-500 truncate">${escapedContent.substring(
                              0,
                              50
                            )}...</p>
                            ${
                              note.aiGenerated
                                ? '<span class="text-xs text-purple-600">‚ú® AI Generated</span>'
                                : ""
                            }
                        </div>
                        <button onclick="deleteNote(event, '${escapedId}')" 
                                class="ml-2 p-1 text-red-500 hover:bg-red-50 rounded">üóëÔ∏è</button>
                    </div>
                </div>
            `;
          })
          .join("");
      }

      function createNewNote() {
        currentNote = null;
        document.getElementById("noteTitle").value = "";
        document.getElementById("noteContent").value = "";
        showEditor();
      }

      function showEditor() {
        document.getElementById("emptyState").classList.add("hidden");
        document.getElementById("editor").classList.remove("hidden");
      }

      function hideEditor() {
        document.getElementById("emptyState").classList.remove("hidden");
        document.getElementById("editor").classList.add("hidden");
      }

      function editNote(id) {
        const note = notes.find((n) => n.id === id);
        if (note) {
          currentNote = note;
          document.getElementById("noteTitle").value = note.title;
          document.getElementById("noteContent").value = note.content;
          showEditor();
        }
      }

      function saveNote() {
        const title = document.getElementById("noteTitle").value.trim();
        const content = document.getElementById("noteContent").value.trim();

        if (!title || !content) {
          alert("Please add both title and content");
          return;
        }

        if (currentNote && currentNote.id) {
          // Update existing note
          const noteIndex = notes.findIndex((n) => n.id === currentNote.id);
          if (noteIndex !== -1) {
            notes[noteIndex].title = title;
            notes[noteIndex].content = content;
            notes[noteIndex].timestamp = Date.now();
          }
        } else {
          // Create new note
          const newNote = {
            id: Date.now().toString(),
            title,
            content,
            timestamp: Date.now(),
            aiGenerated: currentNote?.aiGenerated || false,
          };
          notes.unshift(newNote);
        }

        saveNotes();
        renderNotesList();
        alert("Note saved successfully!");
        cancelEdit();
      }

      function deleteNote(event, id) {
        event.stopPropagation();
        if (!confirm("Delete this note?")) return;

        notes = notes.filter((n) => n.id !== id);
        saveNotes();
        renderNotesList();

        if (currentNote?.id === id) {
          cancelEdit();
        }
      }

      function cancelEdit() {
        currentNote = null;
        hideEditor();
      }

      function toggleAiPanel() {
        document.getElementById("aiPanel").classList.toggle("hidden");
      }

      function toggleSettings() {
        const panel = document.getElementById("settingsPanel");
        const toggle = document.getElementById("settingsToggle");
        panel.classList.toggle("hidden");
        toggle.textContent = panel.classList.contains("hidden") ? "‚ñº" : "‚ñ≤";
      }

      function saveApiKey() {
        apiKey = document.getElementById("apiKey").value.trim();
        apiProvider = document.getElementById("aiProvider").value;

        if (apiKey) {
          localStorage.setItem("aiApiKey", apiKey);
          localStorage.setItem("aiProvider", apiProvider);
          alert("API key saved! You can now use AI features.");
        } else {
          alert("Please enter an API key");
        }
      }

      function updateApiKeyPlaceholder() {
        const provider = document.getElementById("aiProvider").value;
        const links = {
          groq: "https://console.groq.com",
          openai: "https://platform.openai.com/api-keys",
          anthropic: "https://console.anthropic.com",
        };
        document.getElementById("apiLink").href = links[provider];
        document.getElementById("apiLink").textContent = links[
          provider
        ].replace("https://", "");
      }

      async function generateWithAI() {
        const prompt = document.getElementById("aiPrompt").value.trim();

        if (!prompt) {
          alert("Please enter a prompt");
          return;
        }

        if (!apiKey) {
          alert("Please set up your API key first!");
          return;
        }

        const button = event.target;
        button.disabled = true;
        button.textContent = "Generating...";

        try {
          let content;

          if (apiProvider === "groq") {
            content = await callGroqAPI(prompt);
          } else if (apiProvider === "openai") {
            content = await callOpenAI(prompt);
          } else if (apiProvider === "anthropic") {
            content = await callAnthropic(prompt);
          }

          document.getElementById("noteTitle").value = prompt;
          document.getElementById("noteContent").value = content;
          currentNote = { aiGenerated: true };
          showEditor();
          toggleAiPanel();
          document.getElementById("aiPrompt").value = "";
        } catch (error) {
          alert("AI generation failed: " + error.message);
        } finally {
          button.disabled = false;
          button.textContent = "Generate Note";
        }
      }

      async function callGroqAPI(prompt) {
        const response = await fetch(
          "https://api.groq.com/openai/v1/chat/completions",
          {
            method: "POST",
            headers: {
              Authorization: `Bearer ${apiKey}`,
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              model: "llama-3.3-70b-versatile",
              messages: [
                {
                  role: "user",
                  content: `Create detailed, well-structured notes about: ${prompt}. Include key points, explanations, and examples.`,
                },
              ],
              temperature: 0.7,
              max_tokens: 2000,
            }),
          }
        );

        if (!response.ok) throw new Error("API request failed");
        const data = await response.json();
        return data.choices[0].message.content;
      }

      async function callOpenAI(prompt) {
        const response = await fetch(
          "https://api.openai.com/v1/chat/completions",
          {
            method: "POST",
            headers: {
              Authorization: `Bearer ${apiKey}`,
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              model: "gpt-3.5-turbo",
              messages: [
                {
                  role: "user",
                  content: `Create detailed, well-structured notes about: ${prompt}`,
                },
              ],
            }),
          }
        );

        if (!response.ok) throw new Error("API request failed");
        const data = await response.json();
        return data.choices[0].message.content;
      }

      async function callAnthropic(prompt) {
        const response = await fetch("https://api.anthropic.com/v1/messages", {
          method: "POST",
          headers: {
            "x-api-key": apiKey,
            "anthropic-version": "2023-06-01",
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            model: "claude-3-haiku-20240307",
            max_tokens: 2000,
            messages: [
              {
                role: "user",
                content: `Create detailed, well-structured notes about: ${prompt}`,
              },
            ],
          }),
        });

        if (!response.ok) throw new Error("API request failed");
        const data = await response.json();
        return data.content[0].text;
      }

      async function summarizeWithAI() {
        const content = document.getElementById("noteContent").value.trim();

        if (!content) {
          alert("No content to summarize");
          return;
        }

        if (!apiKey) {
          alert("Please set up your API key first!");
          return;
        }

        const button = event.target;
        button.disabled = true;
        button.textContent = "Summarizing...";

        try {
          let summary;
          const prompt = `Summarize the following notes concisely, highlighting key points:\n\n${content}`;

          if (apiProvider === "groq") {
            summary = await callGroqAPI(prompt);
          } else if (apiProvider === "openai") {
            summary = await callOpenAI(prompt);
          } else if (apiProvider === "anthropic") {
            summary = await callAnthropic(prompt);
          }

          document.getElementById(
            "noteContent"
          ).value = `## AI Summary\n\n${summary}\n\n---\n\n## Original Content\n\n${content}`;
        } catch (error) {
          alert("Summarization failed: " + error.message);
        } finally {
          button.disabled = false;
          button.textContent = "‚ú® AI Summarize";
        }
      }

      // Export notes as JSON file
      function exportNotes() {
        if (notes.length === 0) {
          alert("No notes to export!");
          return;
        }

        try {
          const dataStr = JSON.stringify(notes, null, 2);
          const blob = new Blob([dataStr], { type: "application/json" });
          const url = URL.createObjectURL(blob);
          const link = document.createElement("a");
          link.href = url;
          const date = new Date().toISOString().split("T")[0];
          link.download = `ai-notes-backup-${date}.json`;
          link.style.display = "none";
          document.body.appendChild(link);
          link.click();

          // Cleanup
          setTimeout(() => {
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
          }, 100);

          alert(`Exported ${notes.length} notes successfully!`);
        } catch (error) {
          alert("Export failed: " + error.message);
        }
      }

      // Trigger file input for import
      function importNotes() {
        document.getElementById("importFile").click();
      }

      // Handle imported file
      function handleImport(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function (e) {
          try {
            const importedNotes = JSON.parse(e.target.result);

            if (!Array.isArray(importedNotes)) {
              alert(
                "Invalid file format! Please select a valid notes backup file."
              );
              return;
            }

            const confirmMsg = `Import ${importedNotes.length} notes?\n\nThis will ADD to your existing ${notes.length} notes (not replace them).`;
            if (!confirm(confirmMsg)) {
              event.target.value = "";
              return;
            }

            // Add imported notes (newer ones first)
            notes = [...importedNotes, ...notes];

            // Remove duplicates based on ID
            const uniqueNotes = [];
            const seenIds = new Set();
            for (const note of notes) {
              if (!seenIds.has(note.id)) {
                seenIds.add(note.id);
                uniqueNotes.push(note);
              }
            }
            notes = uniqueNotes;

            saveNotes();
            renderNotesList();
            alert(`Successfully imported ${importedNotes.length} notes!`);
          } catch (error) {
            alert("Failed to import: Invalid JSON file or corrupted data");
            console.error("Import error:", error);
          }

          // Reset file input
          event.target.value = "";
        };

        reader.onerror = function () {
          alert("Failed to read file");
          event.target.value = "";
        };

        reader.readAsText(file);
      }

      // Initialize
      document.getElementById("aiProvider").value = apiProvider;
      if (apiKey) document.getElementById("apiKey").value = apiKey;
      updateApiKeyPlaceholder();
      loadNotes();
    </script>
  </body>
</html>
